# nginx.conf

# Bagian worker dan event biarkan default
worker_processes  1;
events {
    worker_connections  1024;
}

http {
    include       "D:/dashboard-aws/mime.types";
    default_type  application/octet-stream;

    # Definisikan path log dan temp secara eksplisit
    # Pastikan folder 'logs' dan 'temp' ada di D:\dashboard-aws\
    error_log  logs/error.log;
    access_log logs/access.log;
    client_body_temp_path temp/client_body;
    proxy_temp_path       temp/proxy;
    fastcgi_temp_path     temp/fastcgi;
    uwsgi_temp_path       temp/uwsgi;
    scgi_temp_path        temp/scgi;

    sendfile        on;
    keepalive_timeout  65;

    # Konfigurasi server utama untuk aplikasi Laravel Anda
    server {
        listen       80;
        server_name  localhost;
        root         "D:/dashboard-aws/public"; # Path absolut ke folder public
        index        index.php index.html index.htm;

        # Blok location utama untuk menangani semua request
        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        # Blok location khusus untuk memproses file PHP
        location ~ \.php$ {
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include        "D:/dashboard-aws/nginx/fastcgi_params";

            # Timeout settings untuk query database yang lama
            fastcgi_read_timeout 300s;
            fastcgi_connect_timeout 60s;
        }

        # Blokir akses ke file .htaccess
        location ~ /\.ht {
            deny all;
        }
    }
}
